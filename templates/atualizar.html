<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='estilo.css') }}">
    <title>Analisar Solicitação</title>
</head>
<body>

    <header class="header">
        <img src="https://www.portovelho.ro.gov.br/assets/site/img/logos/Prefeitura_Horizontal_Azul.svg" alt="Gerenciamento de Solicitações - Prefeitura de Porto Velho">
    </header>

    <div class="content-wrapper">
        <main class="container">
            <h2>Analisar Solicitação #{{ solicitacao.id }}</h2>
            
            <p><strong>Categoria:</strong> {{ solicitacao.categoria }}</p>
            <p><strong>Endereço:</strong> {{ solicitacao.endereco }}</p>
            <p><strong>Descrição do Cidadão:</strong> {{ solicitacao.descricao }}</p>
            
            <form id="analysis-form" method="POST" action="{{ url_for('atualizar_solicitacao', id=solicitacao.id) }}">
                <label for="novo_status">Alterar status para:</label>
                <select id="novo_status" name="novo_status">
                    <option value="Pendente" {% if solicitacao.status == 'Pendente' %}selected{% endif %}>Pendente</option>
                    <option value="Em Análise" {% if solicitacao.status == 'Em Análise' %}selected{% endif %}>Em Análise</option>
                    <option value="Agendada" {% if solicitacao.status == 'Agendada' %}selected{% endif %}>Agendada</option>
                    <option value="Em Andamento" {% if solicitacao.status == 'Em Andamento' %}selected{% endif %}>Em Andamento</option>
                    <option value="Concluída" {% if solicitacao.status == 'Concluída' %}selected{% endif %}>Concluída</option>
                    <option value="Cancelado" {% if solicitacao.status == 'Cancelado' %}selected{% endif %}>Cancelado</option>
                </select>

                <div id="agendamento-div" style="display: none;">
                    <label for="data_agendamento">Agendar execução para:</label>
                    <input type="date" id="data_agendamento" name="data_agendamento" value="{{ solicitacao.data_agendamento }}">
                </div>

                <label for="justificativa">Justificativa / Observação Interna:</label>
                <textarea id="justificativa" name="justificativa" rows="4">{{ solicitacao.justificativa }}</textarea>

                <input type="submit" value="Salvar Alterações">
            </form>
        </main>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/e/e5/Bras%C3%A3o_de_Porto_Velho.png" alt="Vamos mudar a nossa Porto Velho">
            </div>
            <div class="footer-info">
                <p><strong>Prefeitura de Porto Velho</strong></p>
                <address>R. Dom Pedro II, 826 - Centro<br>Porto Velho - RO, 76801-908</address>
            </div>
        </div>
        <div class="footer-bottom">
            © 2025 Four Source - Desenvolvido para o Berá Hackathon
        </div>
    </footer>

    <script>
        // 1. Pegamos as "ferramentas" que vamos usar
        const form = document.getElementById('analysis-form');
        const statusSelect = document.getElementById('novo_status');
        const justificationText = document.getElementById('justificativa');
        const agendamentoDiv = document.getElementById('agendamento-div');

        // 2. Criamos a função que mostra ou esconde o campo de data
        function toggleAgendamento() {
            const status = statusSelect.value;
            if (status === 'Agendada' || status === 'Em Andamento' || status === 'Concluída') {
                agendamentoDiv.style.display = 'block';
            } else {
                agendamentoDiv.style.display = 'none';
            }
        }

        // 3. Ensinamos o sistema a "ouvir" o envio do formulário
        form.addEventListener('submit', function(event) {
            if (statusSelect.value === 'Cancelado' && justificationText.value.trim() === '') {
                event.preventDefault();
                alert('Por favor, preencha o campo de justificativa para cancelar a solicitação.');
                justificationText.focus();
            }
        });

        // 4. Ensinamos o sistema a "ouvir" qualquer mudança no menu de status
        statusSelect.addEventListener('change', toggleAgendamento);

        // 5. Executamos a função uma vez assim que a página carrega
        toggleAgendamento();
    </script>

</body>
</html>